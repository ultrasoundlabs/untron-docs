(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[118],{6138:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/architecture",function(){return r(5423)}])},5423:function(e,s,r){"use strict";r.r(s),r.d(s,{__toc:function(){return c}});var n=r(5893),o=r(2673),l=r(8647),i=r(1255);r(9488);var t=r(2643),a=r(8757);let c=[{depth:2,value:"Relayers and Fulfillers",id:"relayers-and-fulfillers"},{depth:2,value:"Relayer Software's Logic",id:"relayer-softwares-logic"},{depth:2,value:"Initialization",id:"initialization"},{depth:2,value:"Build.rs",id:"buildrs"}];function h(e){let s=Object.assign({h1:"h1",p:"p",ul:"ul",li:"li",h2:"h2",em:"em",code:"code",pre:"pre",span:"span",a:"a",strong:"strong"},(0,t.a)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{children:"How Untron works"}),"\n",(0,n.jsx)(s.p,{children:"Although seeming not obvious at all, we decided to start this deep dive into Untron protocol from its relayer software. Why? Well, Untron's relayer is, in fact, the thing that runs Untron. It's connected to all critical components of the protocol and orchestrates its operation. Therefore, we can start by explaining how the Relayer connects things you don't yet understand, and then move on to explaining those things."}),"\n",(0,n.jsx)(s.p,{children:"Firstly, let's outline three main rules Untron relayer was built according to:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Relayer is a starter. Therefore, all it must do is to start things that are already working properly when started;"}),"\n",(0,n.jsx)(s.li,{children:"From this it follows that the Relayer must not be the source of trustâ€”the worst thing it could do to the protocol is to go down and cause a liveness failure;"}),"\n",(0,n.jsx)(s.li,{children:"To minimize the risk of and the damage from a potential liveness failure, the Relayer must be permissionless and relatively simple to run."}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"Simplifying, all the Relayer does is generating ZK proofs of the state transition function of Untron Protocol and sending them to the Core contract. This task is permissionless, and anyone can run the relayer, provided they can afford the cost of ZK proof generation."}),"\n",(0,n.jsx)(s.h2,{id:"relayers-and-fulfillers",children:"Relayers and Fulfillers"}),"\n",(0,n.jsxs)(s.p,{children:["Besides relaying, relayer-the-crate implements a ",(0,n.jsx)(s.em,{children:"Fulfiller"}),". Fulfillers advance funds for orders that were already executed (sent USDT Tron for), but this fact was not yet ZK proven onchain. If some order was ",(0,n.jsx)(s.em,{children:"fulfilled"}),", it means that its beneficiary (could be order creator, but not necessarily; see later) has already received its ask on the destination chain after sending USDT Tron, but the Core contract doesn't yet know they did send it. This is because one of the Fulfillers had sent the ask in advance, after seeing that the transfer did indeed happen on Tron blockchain."]}),"\n",(0,n.jsx)(s.p,{children:"Fulfillers carry the risk of Tron blockchain's reorgs and wait for the ZK proof to get their funds back, in exchange for a small fee. Similarly to relaying tasks, fulfillers are not the source of trust, and the worst that can happen if there are no fulfillers live is that the users will receive their funds in about 30 minutes rather than a few seconds. Considering the Tron blockchain has never reorged in its entire history, this risk is negligible."}),"\n",(0,n.jsx)(a.G,{chart:"flowchart TD\n    A[Order Beneficiary] --> B[Order] --> C[Order Executed on Tron Blockchain]\n    A -->|Order beneficiary sends USDT Tron to the provider's receiver| C\n    D[Fulfiller] -->|Sees that the funds for the order were sent| C\n    D -->|Fulfiller advances funds to the beneficiary| A\n    D -->|Order details are updated to pay the fulfiller instead| B\n    E[Relayer] -->|Generates ZK proof and closes the order| B"}),"\n",(0,n.jsx)(s.h2,{id:"relayer-softwares-logic",children:"Relayer Software's Logic"}),"\n",(0,n.jsx)(a.G,{chart:"graph TD\n    subgraph State Reconstruction\n        ReconstructState\n    end\n\n    subgraph Proof Generation\n        ZKProgram[SP1 zkVM program]\n    end\n\n    subgraph Initialization\n        Launch --> TronModule & ZKsyncModule\n        Launch -->|Compile untron-program crate into SP1's target using SP1 SDK and Docker| ZKProgram\n        Launch -->|Always reconstruct state on launch using state print from Core| ReconstructState\n    end\n\n    subgraph State Management\n        STFBuffer[STF input buffer]\n        BufferLimits --> STFBuffer\n        STFBuffer <-->|STF is executed every new Tron block, no matter if new actions are added or not| STF[State Transition Function from untron-program crate]\n        UntronState[Local Untron state] <--> STF\n    end\n\n    subgraph Tron\n        TronModule --> TronNode[Tron blocks API]\n        TronProtocol[Tron Protobuf protocol] -->|Compile using tonic-build| TronNode\n        TronNodeURL[Tron gRPC URL] --> TronNode\n        TronNode -->|New blocks| STFBuffer\n    end\n\n    subgraph ZKsync\n        ZKsyncModule --> CoreContract & RelayerAccount\n        ZKsyncRPC[ZKsync RPC URL] & CoreContractAddress --> CoreContract\n        ZKsyncPrivateKey --> RelayerAccount\n    end\n\n    subgraph Event Handling\n        CoreContract --> EventListener\n        EventListener --> StateUpdatedListener & ActionChainUpdatedListener\n        StateUpdatedListener -->|If not updated by us, reconstruct the new state| ReconstructState\n        ActionChainUpdatedListener -->|New actions| STFBuffer\n    end\n\n    STFBuffer -->|If the limits are exceeded, generate a ZK proof for the STF| ZKProgram\n    ZKProgram <-->|Generate proof| STF\n    ZKProgram -->|Send proof onchain| RelayerAccount\n\n    subgraph Order Fulfillment\n        STF -->|Closed orders| FulfillerModule\n        FulfillerModule -->|Advance funds| RelayerAccount\n    end\n\n    ReconstructState <-->|Fetch Tron blocks| TronNode\n    ReconstructState -->|Create local state copy after reconstruction| UntronState\n\n    RelayerAccount -->|Push proofs & fulfill orders| CoreContract"}),"\n",(0,n.jsx)(s.p,{children:"Now, let's break it down step by step."}),"\n",(0,n.jsx)(s.h2,{id:"initialization",children:"Initialization"}),"\n",(0,n.jsxs)(s.p,{children:["The relayer is initialized with a configuration file (",(0,n.jsx)(s.code,{children:"config.toml"}),"), which contains the following parameters:"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"ethereum.rpc_url"}),": The URL of the ZKsync Era RPC node."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"ethereum.private_key"}),": The private key of the relayer account on ZKsync Era network."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"ethereum.core_address"}),": The address of the Untron Core contract on ZKsync Era network."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"tron.rpc_url"}),": The URL of Tron gRPC node API."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"buffer.max_blocks"}),": The maximum number of new Tron blocks to initiate ZK proof generation. 0 if no limit."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"buffer.max_actions"}),": The maximum number of new Untron actions to initiate ZK proof generation. 0 if no limit."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"buffer.min_interval"}),": The minimum interval between two consecutive ZK proof generations in seconds. 0 if no interval."]}),"\n"]}),"\n",(0,n.jsx)(s.pre,{"data-language":"toml","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"toml","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[ethereum]"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"rpc_url "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"https://mainnet.era.zksync.io"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"private_key "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"0x1234567890123456789012345678901234567890123456789012345678901234"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"core_address "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"0x1234567890123456789012345678901234567890"'})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[tron]"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"rpc_url "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"https://api.trongrid.io/jsonrpc"'})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[buffer]"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"max_blocks "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"200"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"max_actions "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"100"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"min_interval "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"10"})]})]})}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.em,{children:"An example configuration file."})}),"\n",(0,n.jsx)(s.h2,{id:"buildrs",children:"Build.rs"}),"\n",(0,n.jsxs)(s.p,{children:["Before initializing all modules, the Relayer initiates an SP1 zkVM prover instance. It generates Groth16 ZK proofs of State Transition Function (STF) and sends them to the Core contract from the relayer's account. To initiate the prover, the Relayer compiles ",(0,n.jsx)(s.a,{href:"https://github.com/ultrasoundlabs/untron/tree/main/program",children:"untron-program"})," into SP1 zkVM target binary in Docker mode to ensure the ZK program is always the same given the same source code."]}),"\n",(0,n.jsx)(s.pre,{"data-language":"rust","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"rust","data-theme":"default",children:[(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"use"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" sp1_build"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"{build_program_with_args, "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"BuildArgs"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"};"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Protobuf-related imports"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"fn"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"main"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Result"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<(), "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Box"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"dyn"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" std"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"error"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Error"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:">> {"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"    // Protobuf compilation logic above"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"println!"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Building ZK program, make sure Docker is running..."'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" args "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"BuildArgs"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        docker"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"true"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        output_directory"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"./elf"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"to_string"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(),"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:".."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Default"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"default"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    };"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"build_program_with_args"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"../program"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", args);"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Ok"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(())"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsxs)(s.em,{children:["(from ",(0,n.jsx)(s.a,{href:"https://github.com/ultrasoundlabs/untron/tree/main/relayer/build.rs",children:"build.rs"}),")"]})}),"\n",(0,n.jsx)(s.p,{children:"This compilation of untron-program should not be confused with constant calling of the State Transition Function from it. Besides compiling the program as an executable, the Relayer imports its STF as a dependency crate, getting rid of the overhead from initializing SP1 environment every Tron block."}),"\n",(0,n.jsx)(s.pre,{"data-language":"rust","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"rust","data-theme":"default",children:[(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"tracing"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"info!"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Executing state transition function..."'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" _ "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" untron_program"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"stf"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&mut"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" state,"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Execution"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        actions"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" self"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"get_latest_actions"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:".await?"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        blocks,"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    },"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"tracing"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"info!"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"State transition function executed"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" state_hash "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"hash"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"bincode"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"serialize"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"state)"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"unwrap"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"());"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"tracing"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"info!"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"State hash: {:?}"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", hex"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"encode"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(state_hash));"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" contract_state_hash "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" self"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"contract"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"state_hash"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"call"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:".await?"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" state_hash "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" contract_state_hash {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"panic!"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"\"State hash mismatch: {} != {}. This might be the case of Core's misconfiguration or a bug in the relayer. If you think it's the latter, please report it to the developers.\""}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:","})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        hex"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"encode"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(state_hash),"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        hex"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"encode"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(contract_state_hash)"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    );"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsxs)(s.em,{children:["(from ",(0,n.jsx)(s.a,{href:"https://github.com/ultrasoundlabs/untron/tree/main/relayer/src/main.rs",children:"main.rs"}),")"]})}),"\n",(0,n.jsxs)(s.p,{children:["Configuration values under ",(0,n.jsx)(s.code,{children:"tron"})," are used to initiate ",(0,n.jsx)(s.strong,{children:"TronModule"}),". Besides the gRPC URL in it, ",(0,n.jsx)(s.strong,{children:"TronModule"})," requires compiled Tron Protobuf files to decode Tron transactions. They're compiled in ",(0,n.jsx)(s.a,{href:"https://github.com/ultrasoundlabs/untron/tree/main/relayer/build.rs",children:"build.rs"})," using ",(0,n.jsx)(s.a,{href:"https://docs.rs/tonic-build/latest/tonic_build/",children:"tonic-build"})," crate. Untron's repository ",(0,n.jsx)(s.a,{href:"https://github.com/ultrasoundlabs/untron/tree/main/lib/java-tron/protocol/src/main/protos/",children:"includes Tron Protocol as a git submodule"}),", so it's necessary to initialize all submodules before building the Relayer."]}),"\n",(0,n.jsx)(s.pre,{"data-language":"rust","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"rust","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ZK-related imports"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"use"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" std"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"fs;"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"use"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" std"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"io;"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"use"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" std"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"path"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Path"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"fn"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"copy_dir_all"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(src"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"impl"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"AsRef"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Path"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:">, dst"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"impl"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"AsRef"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Path"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:">) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" io"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Result"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<()> {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    fs"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"create_dir_all"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"dst)"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"for"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" entry "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"in"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" fs"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"read_dir"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(src)"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" entry "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" entry"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ty "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" entry"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"file_type"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ty"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"is_dir"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"copy_dir_all"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(entry"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"path"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(), dst"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"as_ref"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"join"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(entry"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"file_name"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()))"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        } "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            fs"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"copy"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(entry"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"path"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(), dst"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"as_ref"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"join"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(entry"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"file_name"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()))"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Ok"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(())"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"fn"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"main"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Result"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<(), "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Box"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"dyn"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" std"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"error"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Error"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:">> {"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"println!"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Building Tron protocol... If it fails, make sure you initialized submodules in this repo."'})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    );"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"copy_dir_all"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        Path"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"new"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"../lib/googleapis/google"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"),"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        Path"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"new"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"../lib/java-tron/protocol/src/main/protos/google"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"),"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    )"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    tonic_build"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"configure"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"build_server"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"false"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"boxed"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"BlockExtention"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"compile"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"["}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"../lib/java-tron/protocol/src/main/protos/api/api.proto"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"],"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"["}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"../lib/java-tron/protocol/src/main/protos"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"],"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        )"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    fs"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"remove_dir_all"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"../lib/java-tron/protocol/src/main/protos/google"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"    // ZK program compilation logic below"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "})]})}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsxs)(s.em,{children:["(from ",(0,n.jsx)(s.a,{href:"https://github.com/ultrasoundlabs/untron/tree/main/relayer/build.rs",children:"build.rs"}),")"]})})]})}let d={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,t.a)(),e.components);return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(h,{...e})}):h(e)},pageOpts:{filePath:"pages/architecture/index.mdx",route:"/architecture",timestamp:172721137e4,pageMap:[{kind:"Meta",data:{index:"Introduction",navigation:"Getting Started",architecture:"How Untron Works",integrate:"Integrate Untron",contribute:"Contribute"}},{kind:"Folder",name:"architecture",route:"/architecture",children:[{kind:"Meta",data:{index:"Untron Explained Upside Down",program:"ZK Program",core:"Core Smart Contract",relayer:"Relayer Software",end:"That's it!"}},{kind:"MdxPage",name:"core",route:"/architecture/core"},{kind:"MdxPage",name:"end",route:"/architecture/end"},{kind:"MdxPage",name:"index",route:"/architecture"},{kind:"MdxPage",name:"program",route:"/architecture/program"},{kind:"MdxPage",name:"relayer",route:"/architecture/relayer"}]},{kind:"MdxPage",name:"contribute",route:"/contribute"},{kind:"MdxPage",name:"index",route:"/"},{kind:"MdxPage",name:"integrate",route:"/integrate"},{kind:"MdxPage",name:"navigation",route:"/navigation"}],flexsearch:{codeblocks:!0},title:"How Untron works",headings:c},pageNextRoute:"/architecture",nextraLayout:l.ZP,themeConfig:i.Z};s.default=(0,o.j)(d)},1255:function(e,s,r){"use strict";var n=r(5893),o=r(7294),l=r(2010),i=r(5675),t=r.n(i);s.Z={logo:()=>{let{theme:e,resolvedTheme:s}=(0,l.F)(),[r,i]=(0,o.useState)(!1);return((0,o.useEffect)(()=>{i(!0)},[]),r)?(0,n.jsx)("span",{style:{display:"flex",alignItems:"center"},children:(0,n.jsx)(t(),{src:"dark"===("system"===e?s:e)?"/untron-docs/logo/white.png":"/untron-docs/logo/black.png",alt:"Untron Logo",width:128,height:128})}):null},project:{link:"https://github.com/ultrasoundlabs/untron"},docsRepositoryBase:"https://github.com/ultrasoundlabs/untron-docs/blob/main",footer:{text:"Untron Documentation"}}},5789:function(){}},function(e){e.O(0,[83,387,856,888,774,179],function(){return e(e.s=6138)}),_N_E=e.O()}]);